# 6.2.1 总线事务

> 从请求总线到完成总线使用的操作序列称为总线事务, 它是在一个总线周期中发生的一系列活动

1. 请求阶段: 主设备(CPU或DMA)发出总线传输请求, 并且获得总线控制权
2. 仲裁阶段: 总线仲裁机构决定将下一个传输周期的总线使用权授予某个申请者
3. 寻址阶段: 主设备通过总线给出要访问的从设备地址及有关命令, 启动从模块
4. 传输阶段: 主模块和从模块进行数据交换, 可单向或双向进行数据传送
5. 释放阶段: 主模块的有关信息均从系统总线上撤除, 让出总线使用权

总线上的数据传送方式分为非突发方式和突发方式两种
+ 非突发传送方式: 在每个传送周期内都先传送地址, 再传送数据, 主、从设备之间通常每次只能传输一个字长的数据
+ 突发(猝发)传送方式: 能够进行**连续成组数据的传送**, **其寻址阶段发送的是连续数据单元的首地址, 在传输阶段传送多个连续单元的数据**, 每个时钟周期可以传送一个字长的信息, 但是不释放总线, **直到一组数据全部传送完毕后, 再释放总线**

# 6.2.2 总线定时

> 总线在双方交换数据的过程中需要时间上配合关系的控制
> 其实质是一种协议或规则，主要有同步、异步、半同步和分离式四种定时方式。

## 同步定时方式

> 系统采用一个统一的时钟信号来协调发送和接收双方的传送定时关系
> 时钟产生相等的时间间隔, 每个间隔构成一个总线周期
> 在一个[[6.1 总线概述#^e3bbdf|总线周期]]中，发送方和接收方可以进行一次数据传送, 因为采用统一的时钟，每个部件或设备发送或接收信息都在固定的总线传送周期中, 一个总线的传送周期结束, 下一个总线的传送周期开始


+ 优点：传送速度快, 具有较高的传输速率; 总线控制逻辑简单
+ 缺点: 主从设备属于强制性同步; 不能及时进行数据通信的有效性检验, 可靠性较差

>[!note] **同步通信适用于总线长度较短及总线所接部件的存取时间比较接近的系统**

同步串行通信方式是发送方时钟直接控制接收方时钟, 使双方完全同步的一种逐位传输的通信方式. 使用同步串行通信时, 收发双方的时钟严格一致, 因此仅在数据块的头尾处添加了开始和结束标记, **传输效率较高, 但实现的硬件设备也更复杂, 所以较少采用**。

## 异步定时方式

> 完全依靠传送双方相互制约的"握手"信号来实现定时控制
> 主设备提出交换信息的"请求"信号, 通过接口传送到从设备
> 从设备接到主设备的请求后，通过接口向主设备发出"回答"信号

+ 优点: **总线周期长度可变**, 能保证两个工作速度相差很大的部件或设备之间可靠地进行信息交换, 自动适应时间的配合
+ 缺点: 比同步控制方式稍复杂一些, **速度比同步定时方式慢**

根据"请求"和"回答"信号的撤销是否互锁，异步定时方式又分为以下3种类型: 
1. 不互锁方式: 主设备发出"请求"信号后, 不必等到接到从设备的"回答"信号, 而是经过一段时间便撤销"请求"信号
   而从设备在接到“请求”信号后, 发出“回答”信号, 并经过一段时间后自动撤销“回答”信号
2. 半互锁方式: 主设备发出: 请求”信号后, 必须在接到从设备的"回答"信号后, 才撤销"请求"信号, 有互锁的关系
   而从设备在接到"请求"信号后, 发出"回答"信号, 但不必等待获知主设备的"请求"信号已经撤销, 而是隔一段时间后自动撤销"回答"信号，不存在互锁关系
3. 全互锁方式: 主设备发出"请求"信号后, 必须在从设备"回答"后才撤销"请求"信号
   从设备发出"回答"信号后, 必须在获知主设备"请求"信号已撤销后, 再撤销其"回答"信号
![[请求和回答地互锁.png]]

## 半同步定时方式

> 同步定时的特点, 如所有地址、命令、数据信号的发出时间都严格参照系统时钟的某个前沿开始, 而接收方都采用系统时钟后沿时刻来进行判断识别；同时又像异步定时那样, 允许不同速度的设备和谐地工作
> **为此增设一条Wait响应信号线**

>[!note] 半同步定时方式适用于系统工作速度不高, 但又包含了由许多速度差异较大的各类设备组成的简单系统

+ 优点: 控制方式比异步定时简单, 各模块在系统时钟的控制下同步工作, 可靠性较高
+ 缺点: 系统时钟频率不能要求太高, 所以从整体上来看, 系统工作的速度不是很高

## 分离式定时方式

> 将总线事务分解为请求和应答两个子过程
> 在第一个子过程中, 主设备A获得总线使用权后, 将命令、地址等信息发到总线上, 经总线传输后由从设备B接收
> 此过程占用总线的时间很短, **主设备一旦发送完, 立即释放总线**, 以便其他设备使用
> 在第二个子过程中, 设备B收到设备A发来的有关命令后, 将设备A所需的数据准备好后, 便由设备B申请总线使用权, 一旦获准, 设备B便将相应的数据送到总线上, 由设备A接收
> 上述两个子过程都只有单方向的信息流, 每个设备都变为主设备


+ 优点: 在不传送数据时释放总线, 使总线可接受其他设备的请求, 不存在空闲等待时间
+ 缺点: 控制复杂, 开销也大